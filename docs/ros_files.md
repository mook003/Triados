# Типы файлов ROS

В ROS существует множество файлов. В данном разделе мы опишем некоторые из них, объясним как их создавать и как ими пользоваться.

## Launch файл

Важной частью ROS являются топики, но запускать кадый из них отедльно неудобно. Для этого существует файлы формата `launch`. Они основаны на расширяемом языке разметки XML. 

Для начала давайте создадим простой файл запуска. Перейдите в ранее созданный проект для `Publisher и Subscriber` командой `roscd` и создайте файл запуска:

```bash
touch nodes/test.launch
```

### Основа файла запуска

Откройте новый файл и вставьте следующий код

```xml
<launch>
  <node pkg="<название пакета>" type="Publisher.py" name="<название ноды>"/>
  <node pkg="<название пакета>" type="Subscriber.py" name="<название ноды>"/>
</launch>
```

В теге `launch` содержатся остальные теги для файла запуска. Он имеет только атрибут `deprecated`, который принимает текстовое значение и выводит его, уведомляя о уствревании файла

Тег `node` отвечает за ноды и имеет следующие атрибуты

|Параметр|Описание|Значение|
|-------------------|--------------|-------------------|
|pkg|пакет ноды|текст|
|type|тип ноды|текст|
|name|название ноды|текст|
|args|аргументы, которые получит нода при запуске|значения через пробел|
|machine|название машины, на которой будет запущена нода (ROS может быть запущен на нескольких компьютерах, объединенных единой сетью)|текст|
|respawn|автоматически перезапускает ноду, если она закрылась|true/false|
|respawn_delay|задержка перезапуска|секунды|
|required|при смерти ноды будет убит и весь файл запуска|true/false|
|ns|запуск ноды в пространстве имён|текст|
|clear_params|удаление всех параметров в частном пространстве имен узла перед запуском.|true/false|
|output|screen - отчтёт будет публиковаться в терминале, log - отчёт будет записан в логах|log/screen|
|launch-prefix|префиксы, с которыми будет запущена нода|аргументы префиксов|
|if|true - узел будет запущен, false - узел не будет запущен (можно создавать сложные файлы запуска, где ноды будут запускаться при выполнении определённых условий)|true/false|


Для запуска нужно ввести в терминале следующую команду:

```bash
roslaunch <название пакета> test.launch
```
> **note:** Если добавить ` --screen` в конце, в терминале будет публиковаться отчёт

### Пространства имён

Вы можете объединять ноды в группы так, что они не будут пересекаться даже при одинаковых названиях и топиках. Замените предыдущий код на этот:

```xml
<launch>
  <group ns="ns1">
    <node pkg="<название пакета>" type="Publisher.py" name="<topic_publisher>"/>
    <node pkg="<название пакета>" type="Subscriber.py" name="<topic_subscriber>"/>
  </group>
  <group ns="ns2">
    <node pkg="<название пакета>" type="Publisher.py" name="<topic_publisher>"/>
    <node pkg="<название пакета>" type="Subscriber.py" name="<topic_subscriber>"/>
  </group>
</launch>
```
В данном примере 2 одинаковые пары нод содержатся в разных пространствах имён (`ns1` и `ns2`)

|Параметр|Описание|Значение|
|-------------------|--------------|-------------------|
|ns|запуск ноды в пространстве имён|текст|
|clear_params|удаление всех параметров в частном пространстве имен группы перед запуском.|true/false|

> **note:** Использование атрибута `clear_params` может привести к серьёзным проблемам

Запусите обновлённый файл запуска, откройте новое окно терминала и введите следующую команду: 

```bash
rostopic list
```

Она выведет работающие топики. Вы можете увидеть, что пары изолированы в своих пространствах имен.

### Переменные

Также вы можете добавлять переменные в файлы запуска.  Замените предыдущий код на этот:

<launch>
    <node pkg="test_package" type="test_params.py" name="test_params" output="log" respawn="true">
        <param name="time" value="13:30"/>
        <param name="state" value="ok"/>
    </node>
</launch>

Здесь добавился тег `param`. Он имеет следующие атрибуты:

|Параметр|Описание|Значение|
|-------------------|--------------|-------------------|
|name|название параметра (в него могут быть включены пространства имён)|пространство_имён/название|
|value|определяет значение параметра|текст|
|type|тип параметра (может быть определён автоматически)|str/int/double/bool/yaml|
|textfile|значение параметра может быть считано из текстового файла|$(find <название пакета>)/<путь>/<файл>.txt|
|binfile|значение параметра может быть считано и записано как двоичный файл XML-RPC в кодировке base64|$(find <название пакета>)/<путь>/<файл>|
|command|выходные данные команды будут записаны в значение параметра|$(find <название пакета>)/exe '$(find <название пакета>)/arg.txt'|

Следующая программа может получить информацию от параметров

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import rospy

rospy.init_node('test_params')
one = rospy.get_param('~time','00:00')
two = rospy.get_param('~state','error')

while not rospy.is_shutdown():
    print(one)
    print(two)
```

Первое значение функции `get_param` указыввает параметр, значение которого нужно получить, второй - значение по умолчаниию (оно будет передано, если значение у параметра отсутствует).

Также Вы можете объявлять параметры вне тега `node` следующим способом:

```xml
<launch>
    <arg name="resolution" default="FullHD"/>
    <arg name="state" default="good"/>

    <node pkg="<название пакета>" type="test_params.py" name="test_package" output="log" respawn="true">
        <param name="resolution" value="$(arg resolution)"/>
        <param name="state" value="$(arg state)"/>
    </node>
</launch>
```

В данном примере теги `param` получают значения от тегов `arg`. Подобный способ очень удобен, когда необходимо управялть сложным файлом запуска с большим количеством параметров. Реальный пример таких файлов Вы можете найти в `catkin_ws/src/zed-ros-wrapper/ros_wrapper/launch/`

`arg` имеет следующие атрибуты:

|Параметр|Описание|Значение|
|-------------------|--------------|-------------------|
|name|название параметра|название|
|default|определяет значение по умолчанию|значение|
|value|определяет значение параметра|значение|
|doc|описание параметра (может быть получено при добавлении аргумента `--ros-args` к `roslaunch`)|описание|

### Подключение других .launch файлов

Для боллее удобной работы с Вашими или сторонними пакетами вы можете подключать одни файлы запуска к другим.

```xml
<launch>
  <include file="$(find zed_wrapper)/launch/zed2.launch">
    
  <node pkg="<название пакета>" type="Publisher.py" name="<название ноды>"/>
  <node pkg="<название пакета>" type="Subscriber.py" name="<название ноды>"/>
</launch>
```

Тег `include` 

zed_wrapper zed2.launch

<p align="right">Next | <b><a href="zed.md">Работа с ZED</a></b>
<br/>
Back | <b><a href="ros.md">Введение в ROS</a></b></p>
<p align="center"><sup>2021-2022 TRIADOS | </sup><a href="../README.md#содержание"><sup>Содержание</sup></a></p>
