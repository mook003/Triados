# Параметры камеры

Для начала перейдите в `catkin_ws/src/zed-ros-wrapper/params`. Здесь вы можете увидить файлы, содержащие параметры камер Zed. 
Файл `common.yaml` содержит общие настройки для всех камер ZED. Давайте откроем этот файл и разберём все параметры.

#### Параметры с префиксом `general`

Здесь находятся основные параметры камеры.

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| camera_name | Кастомное название для вашей камеры ZED | текст, стандартное значение = `zed` |
| camera_model | Тип камеры | `zed`: ZED, `zedm`: ZED-M, `zed2`: ZED 2, `zed2i`: ZED 2i |
| camera_flip | Переварачивает данные камеры, если она перевёрнута | `true`,  |
| zed_id   | Выбор камеры по её  ID. Полезно при использовании нескольких камер. Будет игнорироваться, если выбран `SVO` файл | целое число, стандартное значение = `0` |
| serial_number | Выбор камеры по её серийному номеру | целое число, стандартное значение = `0` |
| resolution | Разрешение камеры | `0`: HD2K, `1`: HD1080, `2`: HD720, `3`: VGA |
| grab_frame_rate | Задать частоту кадров | целое число |
| gpu_id | Выброр графического процессора для обработки глубины | целое число, стандартное значение = `-1` |
| base_frame | `Frame_id` кадра, который опорный референс робота | строка, стандартное значение = `base_link` |
| verbose | Включить/отключить подробный режим SDK | `true`, `false` |
| svo_compression | Режим сжатия SVO | `0`: LOSSLESS (PNG/ZSTD), `1`: H264 (AVCHD) ,`2`: H265 (HEVC) |
| self_calib | Включить/отключить ручную калибровку при запуске | `true`,`false` |

#### Параметры с префиксом `video`

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| img_downsample_factor | Коэффициент повторной выборки изображений [0,01,1,0]. SDK работает с собственными размерами изображений, но публикует масштабированное изображение. | дробное число, стандартное значение = `1.0` |
| extrinsic_in_camera_frame | Если установленно значение `false` внешний параметр в `camera_infoбудет` использовать собственный кадр ROS (X - ВПЕРЕД, Z - ВВЕРХ) вместо кадра камеры (Z - ВПЕРЕД, Y - ВНИЗ)| `true`, `flase` |

#### Параметры с префиксом `depth`

Здесь вы можете настроить параметры глубины.

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| quality | Выбор качества карты глубины | `0`: NONE, `1`: PERFORMANCE, `2`: QUALITY, `3`: ULTRA |
| sensing_mode | Выбор режима восприятия глубины(Использовать только для приложений VR/AR) | `0`: STANDARD, `1`: FILL |
| depth_stabilization | Включение стабилизации глубины | `0`: disabled, `1`: enabled |
| openni_depth_mode | Конвертация 32bit глубины в метрах в 16bit миллиметры | `0`: метры, `1`: миллиметры |
| depth_downsample_factor | Коэффициент повторной выборки для матриц глубинных данных [0,01,1,0]. SDK работает с собственными размерами данных, но публикует масштабированные матрицы (карта глубины, облако точек и т.д.) | дробное число, стандартное значение = `1.0` |


#### Параметры с префиксом `pos_tracking`

Благодаря IMU (Акселерометр, гироскоп и магнитометр) камера может отслеживать своё положение относительно начальной точки и изменение положения в пространстве. 

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| pos_tracking_enabled | Включить/отключить отслеживание движения с запуска | `true`, `flase` |
| publish_tf | Включить/отключить публикование TF кадров | `true`, `false` |
| publish_map_tf | Включить/отключить публикование карты TF кадров | `true`, `false` |
| map_frame | Frame_id сообщения `pose` | текст, стандартное= `map` |
| odometry_frame | Frame_id сообщения `odom` | текст, стандартное= `odom` |
| area_memory_db_path | Путь к файлу базы данных для завершения цикла и локализации, который содержит изученную визуальную информацию об окружающей среде | текст, стандартное= `' '` |
| save_area_memory_db_on_exit | Сохраняет карту `known visual features` (изученные визуальные объекты), когда узел правильно закрыт, по пути, указанному area_memory_db_path | `true`, `false`  |
| area_memory | Включение прерывания цикла | `true`, `false` |
| floor_alignment | Указывает, должен ли пол использоваться в качестве начала координат для измерения высоты | `true`, `false` |
| initial_base_pose | Начальная опорная поза | вектор, стандартное = `[0.0, 0.0, 0.0, 0.0, 0.0, 0.0]` -> [X, Y, Z, R, P, Y] |
| init_odom_with_first_valid_pose | Указывает, должна ли одометрия быть инициализирована первой допустимой позой, полученной алгоритмом отслеживания | `true`, `false`  |
| path_pub_rate | Частота (Гц) публикации траекторных сообщений | дробное число, стандартное = `2.0` |
| path_max_count | Максимальное количество поз, хранящихся в массивах поз (-1 для бесконечности) | целое число, стандартное = `-1` |
| two_d_mode | Принудительная навигация на плоскости. Если true, значение Z будет зафиксировано на “fixed_z_value”, крен и тангаж равны нулю | `true`, `false` |
| fixed_z_value | Значение, используемое для координаты Z, если `two_d_mod` установленно в значение `true` | дробное число, стандартное значение = `0.0` |

#### Параметры с префиксом `mapping`

Камера может создавать карту, состаящую из облака точек.

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| mapping_enabled | Включить/отключить модуль построения карты | `true`, `false` |
| resolution | Разрешение облака точек [0.01, 0.2] | дробное число, стандартное значение = `0.1` |
| max_mapping_range | Максимальное значение глубины при построении карты в метрах (-1 для автоматического определения)[2.0, 20.0] | двойное целое число, стандартное значение = `-1` |
| fused_pointcloud_freq | Частота публикации (Гц) 3D-карты в виде облака точек | дробное число, стандартное значение = `1.0` |

#### Динамичные параметры

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| pub_frame_rate | Частота публикации изображений `Video` и `Depth` | дробное число [0.1, 100.0] |
| depth_confidence | Порог для отклонения значений глубины на основе их уверенности. Каждый пиксель глубины имеет соответствующую уверенность. Более низкое значение означает большую уверенность и точность (но меньшую плотность). Верхнее значение уменьшает фильтрацию (больше плотности, меньше уверенности). Значение 100 позволит допускать значения от 0 до 100. (без фильтрации). Значение 90 позволит допускать значения от 10 до 100. (фильтрация самых низких доверительных значений). Значение 30 позволит получить значения от 70 до 100 (сохранение самых высоких доверительных значений и снижение плотности карты глубины). Значение должно быть в [1,100]. По умолчанию порог доверия установлен на уровне 100, что означает, что пиксель глубины не будет отклонен | целое число [0, 100] |
| depth_texture_conf | 	Порог для отклонения значений глубины на основе их достоверности текстуры. Более низкое значение означает большую уверенность и точность (но меньшую плотность). Верхнее значение уменьшает фильтрацию (больше плотности, меньше уверенности). Значение должно быть в [1,100]. По умолчанию порог доверия установлен на уровне 100, что означает, что пиксель глубины не будет отклонен | целое число [0, 100] |
| point_cloud_freq | Частота публикации облака точек | дробное число [0.1, 100.0] |
| brightness | Значение яркости | целое число [0, 8] |
| contrast | Значение контраста | целое число [0, 8] |
| hue | Упрввление оттенками | целое число [0, 11] |
| saturation | Значение насыщенности | целое число [0, 8] |
| sharpness | Значение резкости | целое число [0, 8] |
| gamma | Значение гаммы | целое число [1, 9] |
| auto_exposure_gain | Включить/отключить настройку экспозиции и усиления в автоматическом режиме | `true`, `false` |
| gain | Настройка усиления (только если в `auto_exposure_gain` установлено значение `false`) | целое число [0, 100] |
| exposure | Настройка экспозиции (только если в `auto_exposure_gain` установлено значение `false`) | целое число [0, 100] |
| auto_whitebalance | Включить/отключить настройку баланса белого в автоматическом режиме | `true`, `false` |
| whitebalance_temperature | Задаёт значение цветовой температуры(х100) | целое число [42, 65] |

Эти параметры вы можете изменить в графическом интерфейсе, предоставляемом стеком `rqt`:

``` bash
rosrun rqt_reconfigure rqt_reconfigure
```
Выберите `zed2` > `zed_node`. В открывшемся вы можете изменять все вышеперечисленные динамические параметры камеры, передвигая ползунки.

<img src="https://github.com/mook003/Triados/blob/main/docs/images/rqt_rec.png" width="100%">

Теперь перейдём в файл zed2.yaml. В нём содержатся параметры камеры Zed 2. 

Параметры с префиксом `general` содержат исключительно название модели камеры, которое не следует изменять.

#### Параметры с префиксом `depth`

Изменение этих параметров может сказаться на производительности.

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| min_depth | Минимальное возможное значение глубины ( от 0.2 до 3.0) | дробное число  |
| max_depth | Максимальное возможное значение глубины (до 40.0) | дробное число  |

#### Параметры с префиксом `pos_tracking`

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| imu_fusion | Включить/отключить слияние IMU. Если установлено значение false, будет использоваться только оптическая одометрия. |  `true`, `false`  |

#### Параметры с префиксом `sensors`

Несколько настроек

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| sensors_timestamp_sync | Синхронизация временной метки сообщений датчиков с последним полученым кадром | `true`, `false` |
| publish_imu_tf | Публиковать IMU -> <cam_name>_left_camera_frame | `true`, `false` |

#### Параметры с префиксом `object_detection`

| Параметр | Описание | Значение |
|-------------------|--------------|--------------|
| od_enabled | Включить/отключить модуль обнаружения объектов  | `true`, `false` |
| model | Модель обнаружения объектов | `0`: MULTI_CLASS_BOX - `1`: MULTI_CLASS_BOX_ACCURATE - `2`: HUMAN_BODY_FAST - `3`: HUMAN_BODY_ACCURATE - `4`: MULTI_CLASS_BOX_MEDIUM - `5`: HUMAN_BODY_MEDIUM |
| confidence_threshold | Минимальная вероятность в процентах, при которой объект будет обнаружен | целое число, [0,100] |
| max_range | Максимальное количество обнаруженых объектов | дробное число, стандартно = `15` |
| object_tracking_enabled | Включить/отключить отслеживание объектов | `true`, `false` |
| body_fitting | Включить/отключить обнаружение частей тела человека в моделях `HUMAN_BODY` | `true`, `false` |
| mc_people | Включить/отключить обнаружение людей в моделях `MULTI_CLASS_BOX` | `true`, `false` |
| mc_vehicle | Включить/отключить обнаружение транспорта в моделях `MULTI_CLASS_BOX` | `true`, `false` |
| mc_bag | Включить/отключить обнаружение сумок в моделях `MULTI_CLASS_BOX` | `true`, `false` |
| mc_animal | Включить/отключить обнаружение животных в моделях `MULTI_CLASS_BOX` | `true`, `false` |
| mc_electronics | Включить/отключить обнаружение электроники в моделях `MULTI_CLASS_BOX` | `true`, `false` |
| mc_fruit_vegetable | Включить/отключить обнаружение фруктов и овощей в моделях `MULTI_CLASS_BOX` | `true`, `false` |


<p align="right">Дальше | <b><a href="sensors.md">Датчики</a></b>
<br/>
Назад | <b><a href="zed.md">Работа с ZED</a></b></p>
<p align="center"><sup>2021-2023 TRIADOS | </sup><a href="../README.md#содержание"><sup>Содержание</sup></a></p>
